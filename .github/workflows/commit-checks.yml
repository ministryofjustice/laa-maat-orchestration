name: Commit Checks

on:
  push:
    branches-ignore: [main]

jobs:
  run-commit-checks:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
        with:
          fetch-depth: 0
      - name: Commit message check
        run: |
          # Caveat that this only checks the commits in the current push
          # Do not have access to anything else via the GitHub event
          # Perhaps instead we should do a git log and a grep to search all commits.
          echo "SHA: ${{ github.event.ref }}"
          echo "Modified: ${{ github.event.head_commit.timestamp }}"
          
          output=$(git log main^..HEAD --pretty=oneline | grep -i "forgot")
          echo "Output: $output"
          
          if [[ ! -n "$output" ]]; then
            echo 'Found commits with the keyword "forgot"'
            echo "Please fix-up your PR to make commits more meaningful."
            exit 1
          fi
          
          exit 0
